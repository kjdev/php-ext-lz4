name: Build extension
on:
  push:
  # release:
  #   types: [published]

#permissions:
#  contents: write

jobs:
  # get-extension-matrix:
  #   runs-on: ubuntu-latest
  #   outputs:
  #     matrix: ${{ steps.extension-matrix.outputs.matrix }}
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v4
  #     - name: Get the extension matrix
  #       id: extension-matrix
  #       uses: php/php-windows-builder/extension-matrix@v1

  build:
    # needs: get-extension-matrix
    # runs-on: ${{ matrix.os }}
    # strategy:
    #   matrix: ${{fromJson(needs.get-extension-matrix.outputs.matrix)}}
    # strategy:
    #   matrix:
    #     arch: [x64, x86]
    #     ts: [nts, ts]
    runs-on: windows-2022
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: false
      - name: Build the extension
        uses: php/php-windows-builder/extension@v1
        with:
          # php-version: ${{ matrix.php-version }}
          php-version: '8.4'
          # arch: ${{ matrix.arch }}
          arch: x64
          # ts: ${{ matrix.ts }}
          ts: nts
      #     extension-url: https://github.com/xdebug/xdebug
      #     extension-ref: '3.3.2'

      # - name: Build the extension
      #   uses: php/php-windows-builder/extension@v1
      #   with:
      #     extension-url: https://github.com/xdebug/xdebug
      #     extension-ref: '3.3.2'
      #     php-version: '8.3'
      #     ts: nts
      #     arch: x64
      #     args: --with-xdebug
      #     libs: zlib


  # release:
  #   runs-on: ubuntu-latest
  #   needs: build
  #   if: ${{ github.event_name == 'release' }}
  #   steps:
  #     - name: Upload artifact to the release
  #       uses: php/php-windows-builder/release@v1
  #       with:
  #         release: ${{ github.event.release.tag_name }}
  #         token: ${{ secrets.GITHUB_TOKEN }}
